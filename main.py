import pandas as pd


# Enter path to Excel file
path_to_file = 'data/sample/1.xlsx'

# Manually set the DataFrame parameters (usecols, skiprows, nrows)
df1 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=1, nrows=7, header=0)
df2 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=14, nrows=20, header=0)
df3 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=39, nrows=3, header=0)
df4 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=46, nrows=4, header=0)
df5 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=54, nrows=4, header=0)
df6 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=62, nrows=9, header=0)
df7 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=75, nrows=42, header=0)
df8 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=121, nrows=5, header=0)
df9 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=130, nrows=3, header=0)
df10 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=136, nrows=4, header=0)
df11 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=144, nrows=4, header=0)
df12 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=152, nrows=4, header=0)
df13 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=160, nrows=4, header=0)
df14 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=168, nrows=6, header=0)
df15 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=178, nrows=5, header=0)
df16 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=187, nrows=5, header=0)
df17 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=196, nrows=4, header=0)
df18 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=204, nrows=5, header=0)
df19 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=212, nrows=3, header=0)
df20 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=218, nrows=3, header=0)
df21 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=223, nrows=3, header=0)
df22 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=228, nrows=3, header=0)
df23 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=233, nrows=3, header=0)
df24 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=238, nrows=3, header=0)
df25 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=244, nrows=3, header=0)
df26 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=249, nrows=3, header=0)
df27 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=255, nrows=3, header=0)
df28 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=260, nrows=3, header=0)
df29 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=265, nrows=3, header=0)
df30 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=271, nrows=6, header=0)
df31 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=281, nrows=4, header=0)
df32 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=289, nrows=4, header=0)
df33 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=297, nrows=3, header=0)
df34 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=303, nrows=3, header=0)
df35 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=309, nrows=3, header=0)
df36 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=315, nrows=3, header=0)
df37 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=321, nrows=3, header=0)
df38 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=327, nrows=3, header=0)
df39 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=335, nrows=6, header=0)
df40 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=347, nrows=5, header=0)
df41 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=358, nrows=4, header=0)
df42 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=368, nrows=4, header=0)
df43 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=379, nrows=5, header=0)
df44 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=390, nrows=5, header=0)
df45 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=401, nrows=3, header=0)
df46 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=409, nrows=4, header=0)
df47 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=418, nrows=3, header=0)
df48 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=425, nrows=4, header=0)
df49 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=435, nrows=5, header=0)
df50 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=445, nrows=5, header=0)
df51 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=455, nrows=5, header=0)
df52 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=467, nrows=5, header=0)
df53 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=478, nrows=3, header=0)
df54 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=486, nrows=4, header=0)
df55 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=495, nrows=5, header=0)
df56 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=505, nrows=4, header=0)
df57 = pd.read_excel(path_to_file, engine='openpyxl', usecols='A:C, H', skiprows=514, nrows=3, header=0)


# Create function to process the data
def get_df(data_frame):
    # get the header (str)
    list_of_header = data_frame.columns.values.tolist()
    header_str = ''.join([str(i) for i in list_of_header if "Unnamed" not in i])

    # drop unnecessary columns
    data_frame.columns = data_frame.iloc[0]
    data_frame = data_frame.drop(0)
    data_frame = data_frame.drop(1)

    # process the columns
    data_frame.columns = data_frame.columns.str.strip()
    data_frame.columns = [x.replace('\n', ' ') for x in data_frame.columns.to_list()]

    # change the columns' names and split column 'INN' into two columns
    data_frame = data_frame.rename(columns={'Nazwa międzynarodowa': 'Opis', 'Ilość zamawiana': 'Ilość'})
    data_frame['INN'] = data_frame['Opis'].str.split(',').str[0]

    # split header into two columns and fill the rows with it
    def rozdziel(row):
        row['TEMP'] = header_str
        row['Oznaczenie zadania'], row['Tytuł zadania'] = row['TEMP'].split('.', 1)  # 1 - to first occuring
        row = row.drop('TEMP')
        return row

    data_frame = data_frame.apply(rozdziel, axis=1)

    # remove whitespaces
    data_frame['Tytuł zadania'] = data_frame['Tytuł zadania'].str.strip()
    data_frame['Oznaczenie zadania'] = data_frame['Oznaczenie zadania'].str.strip()

    # new order of columns
    new_order = ['Oznaczenie zadania', 'Tytuł zadania', 'Lp', 'Opis', 'INN', 'Ilość']
    data_frame = data_frame[new_order]

    return data_frame


# Concatenate all DataFrames
concated_df = pd.concat([get_df(df1),
                         get_df(df2),
                         get_df(df3),
                         get_df(df4),
                         get_df(df5),
                         get_df(df6),
                         get_df(df7),
                         get_df(df8),
                         get_df(df9),
                         get_df(df10),
                         get_df(df11),
                         get_df(df12),
                         get_df(df13),
                         get_df(df14),
                         get_df(df15),
                         get_df(df16),
                         get_df(df17),
                         get_df(df18),
                         get_df(df19),
                         get_df(df20),
                         get_df(df21),
                         get_df(df22),
                         get_df(df23),
                         get_df(df24),
                         get_df(df25),
                         get_df(df26),
                         get_df(df27),
                         get_df(df28),
                         get_df(df29),
                         get_df(df30),
                         get_df(df31),
                         get_df(df32),
                         get_df(df33),
                         get_df(df34),
                         get_df(df35),
                         get_df(df36),
                         get_df(df37),
                         get_df(df38),
                         get_df(df39),
                         get_df(df40),
                         get_df(df41),
                         get_df(df42),
                         get_df(df43),
                         get_df(df44),
                         get_df(df45),
                         get_df(df46),
                         get_df(df47),
                         get_df(df48),
                         get_df(df49),
                         get_df(df50),
                         get_df(df51),
                         get_df(df52),
                         get_df(df53),
                         get_df(df54),
                         get_df(df55),
                         get_df(df56),
                         get_df(df57),
                         ])

# Save concatenated DataFrame into the Excel file
concated_df.to_excel('output.xlsx', index=False)
